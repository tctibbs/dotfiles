# Tmux Configuration
# Reload config: prefix + r

# =============================================================================
# General Settings
# =============================================================================

# Set true color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Set prefix to Ctrl-a (instead of Ctrl-b)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Display messages for 4 seconds
set -g display-time 4000

# Refresh status bar every 5 seconds
set -g status-interval 5

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Enable mouse support
set -g mouse on

# Don't rename windows automatically
set -g allow-rename off

# =============================================================================
# Key Bindings
# =============================================================================

# Reload configuration
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Switch panes using Alt-arrow without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with Vim-style keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Vim-style copy mode
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i"
bind P paste-buffer
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i"

# Easy window switching
bind -n C-Left previous-window
bind -n C-Right next-window

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Plugin keybindings
bind-key "f" run-shell -b "~/.tmux/plugins/tmux-fzf/scripts/session.sh switch"
bind-key "u" run-shell -b "~/.tmux/plugins/tmux-fzf/scripts/url.sh"

# =============================================================================
# Status Bar Configuration
# =============================================================================
# Custom 256-color status bar (works with xterm-256color terminals)

# Status bar position
set -g status-position bottom

# Status bar colors - Tokyo Night inspired with 256-color palette
set -g status-style bg=colour236,fg=colour147

# Status bar lengths
set -g status-right-length 150
set -g status-left-length 100

# Enable status bar
set -g status on

# Left status - Session name with powerline arrow
set -g status-left "#[fg=colour232,bg=colour111,bold] #S #[fg=colour111,bg=colour236,nobold]"

# Right status - Path, CPU, Battery, Time with powerline separators
set -g status-right "#[fg=colour239,bg=colour236]#[fg=colour147,bg=colour239]  #{b:pane_current_path} #[fg=colour108,bg=colour239]#[fg=colour232,bg=colour108]  #{cpu_percentage} #[fg=colour222,bg=colour108]#[fg=colour232,bg=colour222] #{battery_icon} #{battery_percentage} #[fg=colour170,bg=colour222]#[fg=colour232,bg=colour170]  %m/%d %H:%M "

# Window status - inactive windows
setw -g window-status-style fg=colour147,bg=colour236
setw -g window-status-format " #I:#W "

# Window status - active window
setw -g window-status-current-style fg=colour232,bg=colour111,bold
setw -g window-status-current-format " #I:#W "

# Pane borders - Tokyo Night colors
set -g pane-border-style fg=colour239
set -g pane-active-border-style fg=colour111

# Message text
set -g message-style bg=colour239,fg=colour147

# =============================================================================
# Plugins (TPM - Tmux Plugin Manager)
# =============================================================================
# To install TPM:
# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
#
# To install plugins: prefix + I
# To update plugins: prefix + U
# To uninstall plugins: prefix + alt + u

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-open'

# Plugin settings

# tmux-resurrect & tmux-continuum
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# tmux-fzf
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

# tmux-battery
set -g @batt_icon_charge_tier8 'ðŸ”‹'
set -g @batt_icon_charge_tier7 'ðŸ”‹'
set -g @batt_icon_charge_tier6 'ðŸ”‹'
set -g @batt_icon_charge_tier5 'ðŸ”‹'
set -g @batt_icon_charge_tier4 'ðŸ”‹'
set -g @batt_icon_charge_tier3 'ðŸ”‹'
set -g @batt_icon_charge_tier2 'ðŸ”‹'
set -g @batt_icon_charge_tier1 'ðŸª«'
set -g @batt_icon_status_charged 'ðŸ”Œ'
set -g @batt_icon_status_charging 'âš¡'

# tmux-prefix-highlight
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=yellow,bold'
set -g @prefix_highlight_prefix_prompt 'Wait'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
